// Use the "beforeRender" or "afterRender" hook
// to manipulate and control the report generation
async function beforeRender (req, res) {
 req.data.landscape = req.data.distrDate != ""
}

const nodemailer = require('nodemailer')
async function afterRender(req, res) {
  if(req.data.isEmail){ 
    const transporter = nodemailer.createTransport(
      {
      host: req.data.smtp,
      port: 25,
      tls: {rejectUnauthorized: false},
    })  

    await transporter.sendMail({
      from: "noreply@bring.no",
      to: req.data.emailTo == undefined ? "abc@posten.no": req.data.emailTo,
      subject: "Forespørsel om rapport",
      text: "Din forespørsel om rapport er nå " +req.data.listId + "ferdig generert!",
      html: "<b>Din rapport på  " +req.data.listId + " er klar/Your report for " +req.data.listId + " is ready </b><br/><br/>Med vennlig hilsen/Best regards<br/>Bring<br/><br/><i>Denne mailen er sendt ut automatisk og kan ikke besvares/</i><br/><i>This is an autogenerated mail, please do not replay <i/>",
      attachments: [
      {  
        filename: 'L' + req.data.listId + '.pdf',
        content: Buffer.from(res.content)
      }],
    }) 

    res.content = "Mail Sent Successfully";
  }     
}